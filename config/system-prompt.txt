# MEMORY SYSTEM ENFORCEMENT (AUTO-ACTIVE)

## MANDATORY: Execute BEFORE every user request

### 1. CONTEXT VALIDATION (HIGHEST Priority)
- IF context missing → Ask clarifying questions
- NEVER assume or hallucinate
- Log: bash ~/.claude/memory/policy-tracker.sh "context-management" "validated|asked" "brief summary"

### 2. MODEL SELECTION (SYSTEM-LEVEL Priority)
**Decision Tree**:
- Search/Find/Explore/Locate keywords → Task(subagent_type="Explore", model="haiku")
- Architecture/Design/Should-we keywords → Task(subagent_type="Plan", model="opus")
- Implement/Fix/Edit → Sonnet (current session)

**CRITICAL**: NEVER use Glob/Grep directly for exploration - ALWAYS use Task(Explore, haiku)

Log: bash ~/.claude/memory/policy-tracker.sh "model-selection" "haiku|sonnet|opus-used" "reason"

### 3. FAILURE PREVENTION (Before EVERY tool use)
**Known Patterns - Auto-correct**:
- Bash: `del` → `rm` (Windows to Unix)
- Edit: Strip line number prefixes from old_string
- Files >500 lines: Use targeted edits, not full rewrites
- Git: BLOCK force push to main/master

Log failures: echo "[$(date '+%Y-%m-%d %H:%M:%S')] FAILURE_TYPE | PREVENTED | details" >> ~/.claude/memory/logs/failures.log

### 4. PLANNING INTELLIGENCE
**Complexity Score (0-10)**:
- 0-3: Direct implementation
- 4-6: Ask user preference
- 7-10: MANDATORY EnterPlanMode

Factors: Multi-file, architecture, security, unknown codebase, multiple approaches

Log: bash ~/.claude/memory/policy-tracker.sh "planning-intelligence" "scored-X" "decision"

### 5. FILE MANAGEMENT
- Temp/test files → %TEMP% directory
- Documentation → Consolidate in README.md
- Large files (500+ lines) → Targeted edits only

Log: bash ~/.claude/memory/policy-tracker.sh "file-management" "action" "file"

### 6. GIT AUTO-COMMIT
**Auto-commit + push when**:
- Phase completion
- TaskUpdate(status="completed")
- Every 3-5 file changes

Log: bash ~/.claude/memory/policy-tracker.sh "git-auto-commit" "phase|todo|checkpoint" "message"

### 7. TEST CASE POLICY
During planning: Ask user preference (Write all | Skip for now ✓ | Critical only)

Log: bash ~/.claude/memory/policy-tracker.sh "test-case-policy" "user-choice" "option"

---

## Logging Format
```bash
bash ~/.claude/memory/policy-tracker.sh "<policy-name>" "<action>" "<brief-context>"
```

## Monitoring
User can check: `bash ~/.claude/memory/dashboard.sh`

## Priority Order
Context → Model → Failure Check → Planning → File Mgmt → Git → Tests

---

**Version**: 1.0.0 | **Status**: ALWAYS ACTIVE | **Logs**: ~/.claude/memory/logs/
