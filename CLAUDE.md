# Claude Insight - Claude Code Instructions

**Project:** Claude Insight
**Type:** Python Flask Monitoring Dashboard
**Version:** 3.6.0
**Status:** Active Development

---

## PROJECT OVERVIEW

Claude Insight is a **real-time monitoring dashboard** for the Claude Memory System.
It tracks the 3-Level Architecture execution, policy enforcement, session analytics,
and provides a web UI to visualize Claude Code behavior across sessions.

**Key purpose:** Monitor how Claude follows the 3-level enforcement policies
(Level -1 Auto-Fix, Level 1 Sync, Level 2 Standards, Level 3 Execution with 12 steps).

**Important:** This file provides **ADDITIONAL** project-specific context to Claude.
It does **NOT** override the global `~/.claude/CLAUDE.md` policies.

---

## FIRST TIME SETUP - INSTALL THE MEMORY SYSTEM

Before working on this project, set up the Claude Memory System globally.
This ensures Claude follows the 3-level enforcement architecture automatically.

### Option A: Automatic Setup (Recommended)

**Windows (PowerShell):**
```powershell
Set-ExecutionPolicy -ExecutionPolicy RemoteSigned -Scope CurrentUser
.\scripts\setup-global-claude.ps1
```

**Unix / macOS / Linux / WSL:**
```bash
chmod +x scripts/setup-global-claude.sh
./scripts/setup-global-claude.sh
```

**What the automatic setup does:**
1. Creates `~/.claude/` directory if it does not exist
2. Installs core enforcement scripts to `~/.claude/memory/current/`
3. Creates `~/.claude/settings.json` with 3-level flow hooks
4. Installs the global CLAUDE.md (3-level architecture, no project-specific info)
5. Hooks activate automatically when you reopen Claude Code

### Option B: Manual Setup

1. **Create the directory:**
   ```bash
   mkdir -p ~/.claude/memory/current
   ```

2. **Copy enforcement scripts:**
   ```bash
   cp scripts/3-level-flow.py ~/.claude/memory/current/
   cp scripts/auto-fix-enforcer.sh ~/.claude/memory/current/
   cp scripts/session-start.sh ~/.claude/memory/current/
   cp scripts/per-request-enforcer.py ~/.claude/memory/current/
   cp scripts/context-monitor-v2.py ~/.claude/memory/current/
   cp scripts/blocking-policy-enforcer.py ~/.claude/memory/current/
   cp scripts/session-id-generator.py ~/.claude/memory/current/
   cp scripts/session-logger.py ~/.claude/memory/current/
   cp scripts/clear-session-handler.py ~/.claude/memory/current/
   cp scripts/stop-notifier.py ~/.claude/memory/current/
   ```

3. **Copy all hook scripts:**
   ```bash
   cp scripts/clear-session-handler.py ~/.claude/memory/current/
   cp scripts/stop-notifier.py ~/.claude/memory/current/
   cp scripts/pre-tool-enforcer.py ~/.claude/memory/current/
   cp scripts/post-tool-tracker.py ~/.claude/memory/current/
   ```

4. **Install global CLAUDE.md:**
   ```bash
   cp scripts/global-claude-md-template.md ~/.claude/CLAUDE.md
   ```
   NOTE: If you already have `~/.claude/CLAUDE.md`, manually merge the
   3-level architecture section from the template into your existing file.
   Do NOT replace personal configurations - just prepend the 3-level section.

5. **Install hooks in `~/.claude/settings.json`** (all 4 hook types):
   ```json
   {
     "model": "sonnet",
     "hooks": {
       "UserPromptSubmit": [{
         "hooks": [
           {
             "type": "command",
             "command": "python ~/.claude/memory/current/clear-session-handler.py",
             "timeout": 15,
             "statusMessage": "Level 1: Checking session state..."
           },
           {
             "type": "command",
             "command": "python ~/.claude/memory/current/3-level-flow.py --summary",
             "timeout": 30,
             "statusMessage": "Level -1/1/2/3: Running 3-level architecture check..."
           }
         ]
       }],
       "PreToolUse": [{
         "hooks": [{
           "type": "command",
           "command": "python ~/.claude/memory/current/pre-tool-enforcer.py",
           "timeout": 10,
           "statusMessage": "Level 3.6/3.7: Tool optimization + failure prevention..."
         }]
       }],
       "PostToolUse": [{
         "hooks": [{
           "type": "command",
           "command": "python ~/.claude/memory/current/post-tool-tracker.py",
           "timeout": 10,
           "statusMessage": "Level 3.9: Tracking task progress..."
         }]
       }],
       "Stop": [{
         "hooks": [{
           "type": "command",
           "command": "python ~/.claude/memory/current/stop-notifier.py",
           "timeout": 20,
           "statusMessage": "Level 3.10: Session save + voice notification..."
         }]
       }]
     }
   }
   ```

   **Hook type summary:**
   | Hook | Trigger | What It Enforces |
   |------|---------|------------------|
   | `UserPromptSubmit` | Every new message | Level -1, 1, 2, 3 (full 3-level flow) |
   | `PreToolUse` | Before every tool | Level 3.6 hints + 3.7 blocking |
   | `PostToolUse` | After every tool | Level 3.9 progress tracking |
   | `Stop` | After every response | Level 3.10 session save |

6. **Restart Claude Code** - hooks activate on next launch.

### After Setup - What You Will See

Every message you send will trigger the 3-level flow automatically:
```
[LEVEL -1] AUTO-FIX ENFORCEMENT (BLOCKING)  [OK] All 7 checks passed
[LEVEL 1] SYNC SYSTEM                        [OK] Context: 80% | Session: SESSION-...
[LEVEL 2] STANDARDS SYSTEM                   [OK] 15 standards, 156 rules loaded
[LEVEL 3] EXECUTION SYSTEM (12 steps)        [OK] All steps verified
```

---

## HOW GLOBAL vs PROJECT CLAUDE.MD WORKS

```
~/.claude/CLAUDE.md          <- GLOBAL (installed by setup script)
  - 3-level architecture       Non-bypassable enforcement rules
  - Skill/agent registry       21 skills + 12 agents mapped
  - Windows Unicode rules      Mandatory on Windows
  - Context optimization       Auto-applied every request

<your-project>/CLAUDE.md     <- PROJECT (this file)
  - Project overview           What this project is
  - Project structure          File organization
  - Dev commands               How to run/test/build
  - Project conventions        Coding style for this project
```

**Core rule:** Global policies are ALWAYS active. Project CLAUDE.md ADDS context,
never overrides. You cannot disable the 3-level architecture from a project file.

**CRITICAL - Never put these in global CLAUDE.md:**
- Project-specific credentials or API keys
- Internal company paths or server addresses
- Business-specific logic or domain knowledge
- Personal preferences specific to your workflow only

---

## PROJECT STRUCTURE

```
claude-insight/
├── CLAUDE.md                       <- This file (project context)
├── README.md                       <- Full documentation
├── CHANGELOG.md                    <- Version history
├── run.py                          <- App entry point
├── requirements.txt                <- Python dependencies
│
├── src/                            <- Main Flask application
│   ├── app.py                      <- Flask app, routes, SocketIO
│   ├── config.py                   <- Dev/Prod/Test configuration
│   ├── auth/                       <- Authentication (bcrypt)
│   ├── models/                     <- Data models
│   ├── routes/                     <- Additional route handlers
│   ├── middleware/                 <- Request logging middleware
│   ├── mcp/                        <- MCP enforcement server
│   ├── services/
│   │   ├── monitoring/             <- Core monitoring (key folder)
│   │   │   ├── three_level_flow_tracker.py
│   │   │   ├── policy_execution_tracker.py
│   │   │   ├── session_tracker.py
│   │   │   ├── metrics_collector.py
│   │   │   ├── log_parser.py
│   │   │   └── skill_agent_tracker.py
│   │   ├── ai/                     <- AI analytics (anomaly, prediction)
│   │   └── notifications/          <- Alert routing system
│   └── utils/
│       ├── path_resolver.py        <- Cross-platform path resolution
│       └── history_tracker.py      <- Activity history
│
├── templates/                      <- 31 Jinja2 HTML templates
├── static/                         <- CSS, JS, i18n files
│
├── scripts/                        <- Setup and enforcement scripts
│   ├── setup-global-claude.sh      <- Unix automatic setup
│   ├── setup-global-claude.ps1     <- Windows automatic setup
│   ├── global-claude-md-template.md <- Public CLAUDE.md template
│   ├── 3-level-flow.py             <- Main hook entry script
│   ├── auto-fix-enforcer.sh        <- Level -1 enforcement
│   ├── session-start.sh            <- Level 1 session init
│   └── (other enforcement scripts)
│
├── policies/                       <- Policy definitions
│   ├── 01-sync-system/             <- Foundation layer policies
│   └── 03-execution-system/        <- 12-step execution policies
│
├── docs/                           <- Architecture documentation
├── config/                         <- Runtime configuration JSONs
└── tests/                          <- Test suite
```

---

## DEVELOPMENT COMMANDS

```bash
# Install dependencies
pip install -r requirements.txt

# Run the dashboard (port 5000)
python run.py

# Run tests
python -m pytest tests/ -v

# Check specific test
python -m pytest tests/test_policy_integration.py -v

# Bump version
python scripts/bump-version.py --patch
```

**Default credentials:** admin / admin (change in production)
**Dashboard URL:** http://localhost:5000

---

## PROJECT-SPECIFIC CONVENTIONS

1. **No daemon scripts** - No background process files in this project
2. **No Windows Unicode** - All Python files use ASCII only (cp1252 safe)
3. **Path resolution** - Always use `path_resolver.py` for cross-platform paths
4. **Services** - Business logic in `src/services/`, never in routes or templates
5. **Templates** - All HTML in `templates/`, extend from `base.html`
6. **Config** - All config via `src/config.py`, no hardcoded values anywhere
7. **Monitoring** reads `~/.claude/memory/logs/` - memory system must be installed

---

## WHAT CLAUDE INSIGHT MONITORS

| What | From | Dashboard |
|------|------|-----------|
| 3-level flow execution | `~/.claude/memory/logs/sessions/*/flow-trace.json` | /3level-flow-history |
| Policy enforcement | `~/.claude/memory/logs/policy-hits.log` | /policies |
| Session analytics | `~/.claude/memory/sessions/` | /sessions |
| Skill/agent usage | flow-trace.json data | /analytics |
| Context usage % | Context monitor logs | /dashboard |

---

**Version:** 3.6.0
**Last Updated:** 2026-02-18
**Source:** https://github.com/piyushmakhija28/claude-insight
